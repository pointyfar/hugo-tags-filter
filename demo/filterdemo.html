{{ define "main" }}      

<style>
.tf-filter-item {
  display: none;
  border: 1px solid #333 !important;
}

.tf-wrapper {
  background-color: #fff;
}
.tf-buttons-container {
  background: #fff;
  padding: 16px;
}
.tf-items-container {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  
}
.tf-item {
  width: 300px;
  margin: 8px;
  padding: 4px;
}
button {
    border-radius: 3px;
    padding: 8px 20px;
    text-decoration: none;
    cursor: pointer;
    display: inline-block;
    color: #222;
    border-color: #222;
    background-color: #fff;
    margin: 2px;
}

button.active {
  background-color: #bbb;
}

button:hover {
  background-color: #ddd;
}

.tf-show {
  display: inline-block;
}

</style>

{{ $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
{{ $sections := .Site.Params.mainSections }}

{{ $tags := $.Site.Taxonomies.tags.ByCount }}

{{ $.Scratch.Set "untagged" 0 }}
{{ range $pages }}
  {{ with .Params.tags }}{{ else }}{{ $.Scratch.Add "untagged" 1 }}{{ end }}
{{ end }}

<div class="tf-wrapper">
  <div class="tf-buttons-container flex-grow">
    <h4>Sections</h4>
    <button class="" id="tfSelectAllSections" onclick="htf.showAll('section')">
      All Sections
    </button>
    {{ range $sections }}
      <button class="tfs-button" id="tfs-{{ . | urlize }}" onclick="htf.checkFilter('{{ . | urlize }}', 'tfs-')">
        {{ . | pluralize | title }}
      </button>
    {{ end }}
    
    <hr>
    
    <h4>Tags</h4>
      
    <div class="tf-tag-cloud-wrapper">
      <button class="" id="tfSelectAllTags" onclick="htf.showAll('tag')">
        All Tags
      </button>
      {{ range $tags }}
        {{ if .Term }}
          <button class="tft-button" id="tft-{{.Term | urlize}}" onclick="htf.checkFilter('{{.Term | urlize}}', 'tft-')">
            <span>{{.Term | humanize | title }}</span>
            <span> ({{.Count}})</span>
          </button>
        {{ end }}
      {{ end }}
      {{ if gt ( $.Scratch.Get "untagged") 0 }}
      <button class="tft-button" id="tft-tfuntagged" onclick="htf.checkFilter('tfuntagged', 'tft-')">
        Untagged ({{ $.Scratch.Get "untagged" }})
      </button>
      {{ end }}
    </div>
    
    <hr >
  </div>
      
    
      
      
  <div><h2><span id="selectedItemCount"></span> Items</h2></div>
  <div class="tf-items-container">      
  {{ range ( $pages.ByPublishDate.Reverse ) }}
    <div  class="tf-filter-item tf-item" 
          data-tags="{{ with .Params.tags }}{{ range . }}{{ . | urlize }} {{ end }}{{ else }} tfuntagged{{ end }}"
          data-section="{{ .Section }}"
          >
      <h4><a href="{{ .RelPermalink }}">{{ .Title }}</a></h4>
      {{.Section}}
      <ul>{{ with .Params.tags }}{{ range . }}<li>{{ . | humanize }}</li> {{ end }}{{ else }}<li>untagged</li>{{ end }}</ul>
    </div>
  {{ end }}
  </div>

</div>

<script src="{{ "js/hugotagsfilter.dist.js" | relURL}}"></script>
<script>
var htf = new HugoTagsFilter();
</script>


{{ end }}
